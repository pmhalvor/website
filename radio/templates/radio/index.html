
<html>
	<head>
		<title>radio</title>
		{% load static %}
		<link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
		<link rel="stylesheet" type="text/css" href="{% static 'css/radio.css' %}">
		
	</head>

	<body>
		{% include "includes/navbar.html" %}

		<div class="container">
			<h1 class="title">RADIO</h1>
			<p>{{ intro }}</p>

			<div class="playing" id="playing">
				{% include "includes/playing.html" %}
			</div>


			<br>
			<br>
			<br>

			<h1 style="text-align: right;">recently played</h1>
			<ul class="row">
				<div class="describe">
					<h5>played at</h5>
					<h2>artist</h2>
					<h3>track</h3>
				</div>
				{% for item in recents %}
					<li class="entry">
						<h5> {{ item.played_at }}</h5>
						<a href="{{ item.artist_url }}">
							<h2 style="color:white">{{ item.artist }}</h2>
						</a>
						<a href="{{ item.track_url }}">
							<h3>{{ item.name }}</h3>
						</a>
					</li>
				{% endfor %}
			</ul>
			
		</div>
		

		
		{% include "includes/footer.html" %}

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script type="text/javascript" >  
			// it'd be nice to get this into it's own file
			var progressbar = document.getElementById("bar");

			var duration = "{{ current.duration }}"*1;  // *1 to make int not string
			var progress = "{{ current.progress }}"*1;
			var percentage;

			function updateProgress(){
				progress = progress + 1000;
				if (duration==0){
					// do nothing
					return;
				}
				else if (progress<duration) {
					percentage = Math.round(100*progress/duration);
					progressbar.style.width = percentage +"%";
					progressbar.innerHTML = percentage +"%";
					return percentage;
				}
				else {
					$.ajax({
						url: "{% url 'radio' %}",
						success: function(data) {
							$("#playingArtist").html(data.getElementById("playingArtist"));
							$("#playingTrack").html(data.getElementById("playingTrack"));
							$("#artwork").src(data.getElementById("artwork"));
						}
					});
					// location.reload(true);  // find way to reload only this div's elements, not whole page
					// document.getElementById("playingArtist").innerHTML = "Refresh page for next song";
					// document.getElementById("playingTrack").innerHTML  = "(CTRL + F5)";
					// document.getElementById("artwork").src = "https://perhalvorsen.com/media/img/empty_album.png";
					clearInterval(updating);
				}
			}

			var updating = setInterval(updateProgress, 1000);
		</script>
	</body>

</html>